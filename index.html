<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Pov√≠d√°n√≠ s Minkou</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Nunito', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .chat-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 900px;
            width: 100%;
            display: flex;
            gap: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .bing-side {
            flex: 1;
            text-align: center;
        }
        
        .chat-side {
            flex: 2;
            display: flex;
            flex-direction: column;
            max-height: 500px;
        }
        
        .bing-character {
            position: relative;
        }
        
        .bing-character image {
            filter: brightness(1.2) contrast(1.2) saturate(1.3) drop-shadow(0 4px 8px rgba(0,0,0,0.2));
            transition: all 0.3s ease;
        }
        
        .bing-talking image {
            filter: brightness(1.3) contrast(1.2) saturate(1.4) drop-shadow(0 6px 12px rgba(0,0,0,0.3));
            transform: scale(1.02);
        }
        
        .bing-happy image {
            filter: brightness(1.4) contrast(1.2) saturate(1.5) drop-shadow(0 8px 16px rgba(0,0,0,0.4));
            transform: scale(1.05);
        }
        
        .bing-thinking image {
            filter: brightness(1.1) contrast(1.1) saturate(1.2) drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }
        
        .chat-messages {
            flex: 1;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 20px;
            padding: 20px;
            overflow-y: auto;
            margin-bottom: 20px;
            max-height: 350px;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .message {
            margin: 12px 0;
            padding: 12px 18px;
            border-radius: 18px;
            max-width: 85%;
            word-wrap: break-word;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            animation: messageSlide 0.3s ease-out;
        }
        
        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .user-message {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            margin-left: auto;
            text-align: right;
        }
        
        .bing-message {
            background: linear-gradient(135deg, #FFE66D, #FFD93D);
            color: #2C2C2C;
            margin-right: auto;
        }
        
        .input-area {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        #userInput {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 30px;
            font-size: 16px;
            outline: none;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
            font-family: 'Nunito', sans-serif;
        }
        
        #userInput:focus {
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        button {
            background: linear-gradient(135deg, #FF6B6B, #FF5252);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Nunito', sans-serif;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }
        
        button:hover {
            background: linear-gradient(135deg, #FF5252, #FF1744);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        #speechToggle {
            background: linear-gradient(135deg, #4CAF50, #45a049) !important;
            min-width: 100px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        #speechToggle:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40) !important;
        }
        
        #speechToggle:disabled {
            background: #ccc !important;
            cursor: not-allowed;
        }
        
        /* Mikrofon tlaƒç√≠tko */
        #micButton {
            background: linear-gradient(135deg, #FF6B6B, #FF5252);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Nunito', sans-serif;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }
        
        #micButton:hover {
            background: linear-gradient(135deg, #FF5252, #FF1744);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }
        
        #micButton.listening {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* Mobiln√≠ optimalizace */
        @media (max-width: 768px) {
            .chat-container {
                flex-direction: column;
                padding: 15px;
                gap: 15px;
                max-width: 100%;
                margin: 10px;
            }
            
            .bing-side {
                order: 2;
                width: 100%;
                text-align: center;
            }
            
            .chat-side {
                order: 1;
                width: 100%;
            }
            
            .bing-character svg {
                width: 250px;
                height: 320px;
            }
            
            .input-area {
                flex-direction: column;
                gap: 10px;
            }
            
            #userInput {
                width: 100%;
                margin-bottom: 10px;
            }
            
            button {
                width: 100%;
                margin: 5px 0;
            }
            
            .chat-messages {
                max-height: 300px;
                padding: 15px;
            }
            
            .message {
                max-width: 95%;
                font-size: 14px;
                padding: 10px 15px;
            }
        }
        
        @media (max-width: 480px) {
            .chat-container {
                margin: 5px;
                padding: 10px;
            }
            
            .bing-character svg {
                width: 200px;
                height: 260px;
            }
            
            .chat-messages {
                max-height: 250px;
                padding: 10px;
            }
            
            .message {
                font-size: 13px;
                padding: 8px 12px;
            }
            
            button {
                padding: 12px 20px;
                font-size: 14px;
            }
        }
        
        .bing-talking .right-arm {
            animation: wave 0.6s ease-in-out infinite alternate;
            transform-origin: 195px 190px;
        }
        
        .bing-talking .bus-toy {
            animation: wave-bus 0.6s ease-in-out infinite alternate;
            transform-origin: 195px 190px;
        }
        
        .bing-talking #mouth {
            animation: talk 0.4s ease-in-out infinite alternate;
        }
        
        .bing-talking {
            animation: bounce 0.8s ease-in-out infinite alternate;
        }
        
        .bing-happy {
            animation: happy-bounce 1s ease-in-out;
        }
        
        .bing-thinking {
            animation: thinking 2s ease-in-out infinite;
        }
        
        @keyframes wave {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(-20deg); }
        }
        
        @keyframes wave-bus {
            0% { transform: rotate(0deg) translate(0, 0); }
            100% { transform: rotate(-20deg) translate(-5px, -8px); }
        }
        
        @keyframes talk {
            0% { 
                d: path("M 140 140 Q 150 145 160 140"); 
                opacity: 0.9;
            }
            100% { 
                d: path("M 135 140 Q 150 155 165 140"); 
                opacity: 1;
            }
        }
        
        @keyframes bounce {
            0% { transform: translateY(0px); }
            100% { transform: translateY(-5px); }
        }
        
        @keyframes happy-bounce {
            0% { transform: translateY(0px) scale(1); }
            25% { transform: translateY(-10px) scale(1.05); }
            50% { transform: translateY(-5px) scale(1.1); }
            75% { transform: translateY(-8px) scale(1.05); }
            100% { transform: translateY(0px) scale(1); }
        }
        
        @keyframes thinking {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-2deg); }
            75% { transform: rotate(2deg); }
            100% { transform: rotate(0deg); }
        }
        
        .typing {
            font-style: italic;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="bing-side">
            <div class="bing-character" id="bingCharacter">
                <svg width="320" height="420" viewBox="0 0 320 420" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <!-- Clip path pro hlavu -->
                        <clipPath id="headClip">
                            <ellipse cx="160" cy="130" rx="55" ry="50"/>
                        </clipPath>
                        <!-- Filter pro hlavu -->
                        <filter id="headGlow">
                            <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                            <feMerge> 
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                        <!-- Gradient pro mikinu GAP -->
                        <linearGradient id="hoodieGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#2C3E50;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#34495E;stop-opacity:1" />
                        </linearGradient>
                        <!-- Gradient pro kapuci -->
                        <linearGradient id="hoodGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#34495E;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#2C3E50;stop-opacity:1" />
                        </linearGradient>
                        <!-- Gradient pro kalhoty -->
                        <linearGradient id="pantsGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#1A252F;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#2C3E50;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    
                    <!-- St√≠n pod postavou -->
                    <ellipse cx="160" cy="410" rx="70" ry="20" fill="rgba(0,0,0,0.15)"/>
                    
                    <!-- Mikina GAP - tƒõlo -->
                    <ellipse cx="160" cy="280" rx="70" ry="90" fill="url(#hoodieGradient)" stroke="#1A252F" stroke-width="3"/>
                    
                    <!-- Kapuce mikiny -->
                    <path d="M 90 200 Q 160 150 230 200 L 220 250 Q 160 220 100 250 Z" fill="url(#hoodGradient)" stroke="#1A252F" stroke-width="3"/>
                    
                    <!-- Krk pod kapuc√≠ -->
                    <ellipse cx="160" cy="200" rx="30" ry="20" fill="#FFE4E1"/>
                    
                    <!-- Hlava z fotografie -->
                    <image href="IMG_7287.jpeg" x="105" y="80" width="110" height="110" clip-path="url(#headClip)" preserveAspectRatio="xMidYMid slice" filter="url(#headGlow)"/>
                    
                    <!-- Ruk√°vy mikiny -->
                    <ellipse cx="90" cy="250" rx="25" ry="45" fill="url(#hoodieGradient)" stroke="#1A252F" stroke-width="3"/>
                    <ellipse cx="230" cy="250" rx="25" ry="45" fill="url(#hoodieGradient)" stroke="#1A252F" stroke-width="3"/>
                    
                    <!-- Ruce -->
                    <ellipse cx="90" cy="280" rx="18" ry="35" fill="#FFE4E1"/>
                    <ellipse cx="230" cy="280" rx="18" ry="35" fill="#FFE4E1"/>
                    
                    <!-- Kalhoty -->
                    <ellipse cx="140" cy="380" rx="30" ry="55" fill="url(#pantsGradient)" stroke="#1A252F" stroke-width="3"/>
                    <ellipse cx="180" cy="380" rx="30" ry="55" fill="url(#pantsGradient)" stroke="#1A252F" stroke-width="3"/>
                    
                    <!-- Nohy -->
                    <ellipse cx="140" cy="400" rx="20" ry="40" fill="#FFE4E1"/>
                    <ellipse cx="180" cy="400" rx="20" ry="40" fill="#FFE4E1"/>
                    
                    <!-- Boty -->
                    <ellipse cx="140" cy="420" rx="25" ry="12" fill="#1A252F"/>
                    <ellipse cx="180" cy="420" rx="25" ry="12" fill="#1A252F"/>
                    
                    <!-- GAP logo na mikinƒõ -->
                    <text x="160" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#FFFFFF" opacity="0.95">GAP</text>
                    
                    <!-- Kapsa na mikinƒõ -->
                    <rect x="120" y="320" width="80" height="40" rx="8" fill="#1A252F" opacity="0.4"/>
                    <rect x="125" y="325" width="70" height="30" rx="5" fill="#34495E" opacity="0.6"/>
                    
                    <!-- Zip na mikinƒõ -->
                    <rect x="155" y="200" width="10" height="80" fill="#C0C0C0" opacity="0.8"/>
                    <circle cx="160" cy="200" r="3" fill="#FFD700"/>
                    
                    <!-- √östa pro animaci -->
                    <path id="mouth" d="M 145 170 Q 160 180 175 170" stroke="#FF6B6B" stroke-width="3" fill="none" opacity="0.8">
                        <animate attributeName="d" 
                                 values="M 145 170 Q 160 180 175 170; M 145 175 Q 160 185 175 175; M 145 170 Q 160 180 175 170" 
                                 dur="0.5s" 
                                 repeatCount="indefinite" 
                                 class="talk"/>
                    </path>
                </svg>
            </div>
            <p style="font-size: 18px; color: #667eea; margin-top: 15px; font-weight: 600;"><strong>Ahoj! Jsem Minka! üë¶</strong></p>
            <p style="font-size: 14px; color: #666; margin-top: 5px;">Tv≈Øj nov√Ω kamar√°d</p>
        </div>
        
        <div class="chat-side">
            <div class="chat-messages" id="chatMessages">
                <div class="message bing-message">
                    Ahoj! Jsem Minka a moc r√°d si s tebou pov√≠d√°m! üòä Co tƒõ zaj√≠m√°? M≈Ø≈æeme si pov√≠dat o ƒçemkoliv - o hraƒçk√°ch, hr√°ch, autobusech, ≈°kole nebo o ƒçem chce≈°! Jsem tv≈Øj nov√Ω kamar√°d! üöå‚ú®
                </div>
            </div>
            
            <div class="input-area">
                <input type="text" id="userInput" placeholder="Napi≈° Mince zpr√°vu..." autocomplete="off">
                <button onclick="sendMessage()" type="button">Poslat</button>
                <button id="micButton" onclick="toggleMicrophone()" type="button" style="background: #FF6B6B; margin-left: 10px;">üé§ Mluv</button>
                <button id="speechToggle" onclick="toggleSpeech()" type="button" style="background: #4CAF50; margin-left: 10px;">üîä Mluv√≠</button>
            </div>
        </div>
    </div>
    
    <script>
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const bingCharacter = document.getElementById('bingCharacter');
        
        function addMessage(text, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bing-message'}`;
            messageDiv.textContent = text;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function animateMinka(type = 'talking') {
            // Odstra≈à v≈°echny animace
            bingCharacter.classList.remove('bing-talking', 'bing-happy', 'bing-thinking');
            
            // P≈ôidej novou animaci
            bingCharacter.classList.add(`bing-${type}`);
            
            setTimeout(() => {
                bingCharacter.classList.remove(`bing-${type}`);
            }, type === 'happy' ? 1000 : 2000);
        }
        
        // Text-to-Speech konfigurace - hlas mal√©ho chlapeƒçka
        const TTS_CONFIG = {
            enabled: true,
            voice: 'cs-CZ', // ƒåesk√Ω jazyk
            rate: 0.9, // Rychlost ≈ôeƒçi (chlapeck√°)
            pitch: 1.3, // Vy≈°≈°√≠ pitch pro mal√©ho chlapeƒçka
            volume: 0.9, // Hlasitost
            lang: 'cs-CZ',
            // Hlasov√© parametry pro mal√©ho chlapeƒçka
            boyVoiceSettings: {
                preferredVoices: [
                    'Microsoft Jakub Desktop',    // ƒåesk√Ω mu≈æsk√Ω hlas
                    'Microsoft David Desktop',    // Anglick√Ω mu≈æsk√Ω hlas
                    'Microsoft Mark Desktop',     // Anglick√Ω mu≈æsk√Ω hlas
                    'Google ƒçe≈°tina',             // Google ƒçesk√Ω hlas
                    'Microsoft Richard Desktop'   // Anglick√Ω mu≈æsk√Ω hlas
                ],
                fallbackVoices: [
                    'cs-CZ', 'cs', 'Czech', 'Czech Republic'
                ]
            }
        };
        
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;
        
        // Speech Recognition pro mikrofon
        let recognition = null;
        let isListening = false;
        
        // Inicializuj Speech Recognition
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
            } else if ('SpeechRecognition' in window) {
                recognition = new SpeechRecognition();
            } else {
                console.warn('‚ö†Ô∏è Speech Recognition nen√≠ podporov√°n v tomto prohl√≠≈æeƒçi');
                const micButton = document.getElementById('micButton');
                if (micButton) {
                    micButton.style.display = 'none';
                }
                return false;
            }
            
            // Nastav parametry pro ƒçesk√Ω jazyk
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'cs-CZ';
            recognition.maxAlternatives = 1;
            
            // Event handlery
            recognition.onstart = () => {
                console.log('üé§ Zaƒç√≠n√°m poslouchat...');
                isListening = true;
                const micButton = document.getElementById('micButton');
                if (micButton) {
                    micButton.classList.add('listening');
                    micButton.textContent = 'üî¥ Poslouch√°m...';
                }
                animateMinka('thinking');
            };
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                console.log('üé§ Rozpoznan√Ω text:', transcript);
                
                // Vlo≈æ text do inputu
                const userInput = document.getElementById('userInput');
                userInput.value = transcript;
                
                // Automaticky po≈°li zpr√°vu
                setTimeout(() => {
                    sendMessage();
                }, 500);
            };
            
            recognition.onerror = (event) => {
                console.error('üé§ Chyba p≈ôi rozpozn√°v√°n√≠:', event.error);
                const micButton = document.getElementById('micButton');
                if (micButton) {
                    micButton.textContent = 'üé§ Mluv';
                    micButton.classList.remove('listening');
                }
                isListening = false;
                
                // Zobraz chybovou zpr√°vu
                let errorMessage = 'Chyba p≈ôi rozpozn√°v√°n√≠ ≈ôeƒçi';
                switch(event.error) {
                    case 'no-speech':
                        errorMessage = 'Nesly≈°√≠m ≈æ√°dnou ≈ôeƒç. Zkus to znovu!';
                        break;
                    case 'audio-capture':
                        errorMessage = 'Nem√°m p≈ô√≠stup k mikrofonu. Zkontroluj opr√°vnƒõn√≠!';
                        break;
                    case 'not-allowed':
                        errorMessage = 'Mikrofon nen√≠ povolen. Povol ho v nastaven√≠ prohl√≠≈æeƒçe!';
                        break;
                    case 'network':
                        errorMessage = 'Probl√©m s internetem. Zkus to znovu!';
                        break;
                }
                
                addMessage(errorMessage, false);
                if (TTS_CONFIG.enabled) {
                    speakText(errorMessage);
                }
            };
            
            recognition.onend = () => {
                console.log('üé§ Konec poslouch√°n√≠');
                isListening = false;
                const micButton = document.getElementById('micButton');
                if (micButton) {
                    micButton.textContent = 'üé§ Mluv';
                    micButton.classList.remove('listening');
                }
                bingCharacter.classList.remove('bing-thinking');
            };
            
            return true;
        }
        
        // Toggle mikrofonu
        function toggleMicrophone() {
            if (!recognition) {
                if (!initSpeechRecognition()) {
                    addMessage('Mikrofon nen√≠ dostupn√Ω v tomto prohl√≠≈æeƒçi. Pou≈æij psan√≠!', false);
                    return;
                }
            }
            
            if (isListening) {
                recognition.stop();
            } else {
                try {
                    recognition.start();
                } catch (error) {
                    console.error('Chyba p≈ôi spu≈°tƒõn√≠ rozpozn√°v√°n√≠:', error);
                    addMessage('Nemohu spustit mikrofon. Zkus to znovu!', false);
                }
            }
        }
        
        // Text-to-Speech funkce s hlasem mal√©ho chlapeƒçka
        function speakText(text) {
            if (!TTS_CONFIG.enabled || !speechSynthesis) return;
            
            // Zastav p≈ôedchoz√≠ ≈ôeƒç
            speechSynthesis.cancel();
            
            // Vytvo≈ô novou utterance
            currentUtterance = new SpeechSynthesisUtterance(text);
            
            // Nastav parametry pro mal√©ho chlapeƒçka
            currentUtterance.lang = TTS_CONFIG.lang;
            currentUtterance.rate = TTS_CONFIG.rate;
            currentUtterance.pitch = TTS_CONFIG.pitch;
            currentUtterance.volume = TTS_CONFIG.volume;
            
            // Najdi nejlep≈°√≠ hlas pro mal√©ho chlapeƒçka
            const voices = speechSynthesis.getVoices();
            const bestBoyVoice = findBestBoyVoice(voices);
            
            if (bestBoyVoice) {
                currentUtterance.voice = bestBoyVoice;
                console.log('üë¶ Pou≈æit√Ω hlas chlapeƒçka:', bestBoyVoice.name, `(${bestBoyVoice.lang})`);
            }
            
            // Event handlery
            currentUtterance.onstart = () => {
                console.log('üë¶ Minka zaƒç√≠n√° mluvit jako mal√Ω chlapeƒçek...');
                // Animuj Minku p≈ôi mluven√≠
                animateMinka('talking');
            };
            
            currentUtterance.onend = () => {
                console.log('üë¶ Minka dokonƒçila mluven√≠');
                // Zastav animaci
                bingCharacter.classList.remove('bing-talking');
            };
            
            currentUtterance.onerror = (event) => {
                console.error('Chyba p≈ôi mluven√≠:', event.error);
            };
            
            // Spus≈• ≈ôeƒç
            speechSynthesis.speak(currentUtterance);
        }
        
        // Najdi nejlep≈°√≠ hlas pro mal√©ho chlapeƒçka
        function findBestBoyVoice(voices) {
            if (!voices || voices.length === 0) return null;
            
            // 1. Prioritn√≠ hlasy (mu≈æsk√© hlasy pro chlapeƒçka)
            for (const preferredName of TTS_CONFIG.boyVoiceSettings.preferredVoices) {
                const voice = voices.find(v => 
                    v.name.toLowerCase().includes(preferredName.toLowerCase()) ||
                    v.name === preferredName
                );
                if (voice) {
                    console.log('üë¶ Nalezen prioritn√≠ hlas chlapeƒçka:', voice.name);
                    return voice;
                }
            }
            
            // 2. Hledej mu≈æsk√© hlasy obecnƒõ
            const maleVoices = voices.filter(voice => {
                const name = voice.name.toLowerCase();
                return name.includes('male') || 
                       name.includes('man') || 
                       name.includes('mu≈æ') ||
                       name.includes('jakub') ||
                       name.includes('david') ||
                       name.includes('mark') ||
                       name.includes('richard') ||
                       name.includes('tom') ||
                       name.includes('pavel') ||
                       name.includes('jan');
            });
            
            if (maleVoices.length > 0) {
                console.log('üë¶ Nalezen mu≈æsk√Ω hlas:', maleVoices[0].name);
                return maleVoices[0];
            }
            
            // 3. ƒåesk√© hlasy (priorita pro ƒçesk√Ω chlapeƒçek)
            const czechVoices = voices.filter(voice => 
                voice.lang.startsWith('cs') || 
                voice.name.toLowerCase().includes('czech') ||
                voice.name.toLowerCase().includes('cs')
            );
            
            if (czechVoices.length > 0) {
                console.log('üë¶ Nalezen ƒçesk√Ω hlas:', czechVoices[0].name);
                return czechVoices[0];
            }
            
            // 4. Fallback - prvn√≠ dostupn√Ω hlas
            console.log('üë¶ Pou≈æit fallback hlas:', voices[0].name);
            return voices[0];
        }
        
        function stopSpeaking() {
            if (speechSynthesis) {
                speechSynthesis.cancel();
                bingCharacter.classList.remove('bing-talking');
            }
        }
        
        function toggleSpeech() {
            TTS_CONFIG.enabled = !TTS_CONFIG.enabled;
            const button = document.getElementById('speechToggle');
            if (button) {
                button.textContent = TTS_CONFIG.enabled ? 'üîä Mluv√≠' : 'üîá Nƒõm√Ω';
                button.style.backgroundColor = TTS_CONFIG.enabled ? '#4CAF50' : '#f44336';
            }
            
            if (!TTS_CONFIG.enabled) {
                stopSpeaking();
            }
        }
        
        const AI_CONFIG = {
            // OpenAI API
            openaiApiKey: 'sk-proj-your-api-key-here', // Nahraƒète skuteƒçn√Ωm OpenAI API kl√≠ƒçem
            openaiModel: 'gpt-3.5-turbo',
            maxTokens: 150,
            temperature: 0.8,
            
            // Microsoft Azure OpenAI API (Copilot)
            copilotApiKey: 'your-azure-openai-api-key-here', // Nahraƒète skuteƒçn√Ωm Azure OpenAI API kl√≠ƒçem
            copilotEndpoint: 'https://your-resource-name.openai.azure.com/openai/deployments/your-deployment-name/chat/completions?api-version=2024-02-15-preview',
            copilotModel: 'copilot-gpt-4',
            copilotMaxTokens: 200,
            copilotTemperature: 0.7
        };

        // Vylep≈°en√Ω syst√©m odpovƒõd√≠ s v√≠ce variabilitou
        async function getMinkaResponse(userMessage) {
            // Priorita: Copilot > OpenAI > Fallback
            try {
                // Zkus Copilot API (nejvy≈°≈°√≠ priorita)
                if (AI_CONFIG.copilotApiKey !== 'your-azure-openai-api-key-here') {
                    const copilotResponse = await getCopilotResponse(userMessage);
                    if (copilotResponse) {
                        return copilotResponse;
                    }
                }
            } catch (error) {
                console.log('Copilot API nedostupn√©, zkou≈°√≠m OpenAI:', error);
            }
            
            try {
                // Zkus OpenAI API
                if (AI_CONFIG.openaiApiKey !== 'sk-proj-your-api-key-here') {
                    const openaiResponse = await getOpenAIResponse(userMessage);
                    if (openaiResponse) {
                        return openaiResponse;
                    }
                }
            } catch (error) {
                console.log('OpenAI API nedostupn√©, pou≈æ√≠v√°m fallback:', error);
            }
            
            // Fallback na inteligentn√≠ syst√©m
            return getIntelligentFallback(userMessage);
        }

        function getIntelligentFallback(userMessage) {
            const lowerMessage = userMessage.toLowerCase();
            
            // Konkr√©tn√≠ odpovƒõdi na skuteƒçn√© ot√°zky
            if (lowerMessage.includes('poƒças√≠') || lowerMessage.includes('poƒças')) {
                const weatherResponses = [
                    'Poƒças√≠ je dnes kr√°sn√©! Slun√≠ƒçko sv√≠t√≠! ‚òÄÔ∏è',
                    'Dnes je sluneƒçno! Ide√°ln√≠ na hran√≠ venku!',
                    'Poƒças√≠ je skvƒõl√©! Chce≈° j√≠t ven si hr√°t?',
                    'Je kr√°sn√Ω den! Slun√≠ƒçko sv√≠t√≠ a je teplo!'
                ];
                return weatherResponses[Math.floor(Math.random() * weatherResponses.length)];
            }
            
            if (lowerMessage.includes('kolik je hodin') || lowerMessage.includes('jak√Ω ƒças')) {
                const timeResponses = [
                    'Je ƒças na hran√≠! To je nejlep≈°√≠ ƒças!',
                    'Je ƒças si hr√°t! Co si zahrajeme?',
                    'Je ƒças na z√°bavu! Chce≈° si hr√°t?',
                    'Je ƒças b√Ωt spolu! Co budeme dƒõlat?'
                ];
                return timeResponses[Math.floor(Math.random() * timeResponses.length)];
            }
            
            if (lowerMessage.includes('co je') && lowerMessage.includes('?')) {
                const whatIsResponses = [
                    'To je zaj√≠mav√° ot√°zka! Co si o tom mysl√≠≈°?',
                    'Hmm, to je dobr√° ot√°zka! ≈ò√≠k√°≈° mi, co v√≠≈°?',
                    'To je tƒõ≈æk√©! Mo≈æn√° by n√°m pomohl m≈Øj autobus! üöå',
                    'Zaj√≠mav√©! Nikdy jsem o tom nep≈ôem√Ω≈°lel! A ty?'
                ];
                return whatIsResponses[Math.floor(Math.random() * whatIsResponses.length)];
            }
            
            if (lowerMessage.includes('jak se') && lowerMessage.includes('?')) {
                const howToResponses = [
                    'To je dobr√° ot√°zka! Zkus√≠me to spoleƒçnƒõ!',
                    'Hmm, mo≈æn√° bychom se mohli zeptat nƒõkoho jin√©ho!',
                    'To je tƒõ≈æk√©! Co si o tom mysl√≠≈° ty?',
                    'Zkus√≠me to vy≈ôe≈°it spoleƒçnƒõ! Co navrhuje≈°?'
                ];
                return howToResponses[Math.floor(Math.random() * howToResponses.length)];
            }
            
            if (lowerMessage.includes('proƒç') && lowerMessage.includes('?')) {
                const whyResponses = [
                    'To je dobr√° ot√°zka! Nƒõkdy jsou vƒõci prostƒõ takov√©!',
                    'Hmm, to je tƒõ≈æk√© vysvƒõtlit! Co si mysl√≠≈°?',
                    'To je zaj√≠mav√©! Mo≈æn√° je to proto, ≈æe... co ty?',
                    'Dobr√° ot√°zka! Nƒõkdy prostƒõ nev√≠me proƒç!'
                ];
                return whyResponses[Math.floor(Math.random() * whyResponses.length)];
            }
            
            if (lowerMessage.includes('kde') && lowerMessage.includes('?')) {
                const whereResponses = [
                    'Jsem tady s tebou! A je mi tu moc dob≈ôe!',
                    'Jsem tady! A ty jsi tady se mnou!',
                    'Jsem tady s tebou! Co hled√°≈°?',
                    'Jsem tady! A ty jsi tady taky!'
                ];
                return whereResponses[Math.floor(Math.random() * whereResponses.length)];
            }
            
            if (lowerMessage.includes('kdy') && lowerMessage.includes('?')) {
                const whenResponses = [
                    'Pr√°vƒõ teƒè! Teƒè je ten nejlep≈°√≠ ƒças!',
                    'Teƒè! Teƒè je ƒças na hran√≠!',
                    'Pr√°vƒõ teƒè! Co budeme dƒõlat?',
                    'Teƒè je ten spr√°vn√Ω ƒças! Chce≈° si hr√°t?'
                ];
                return whenResponses[Math.floor(Math.random() * whenResponses.length)];
            }
            
            // Konkr√©tn√≠ t√©mata
            if (lowerMessage.includes('barvy') || lowerMessage.includes('barva')) {
                const colorResponses = [
                    'Barvy jsou √∫≈æasn√©! M≈Øj autobus je ƒçerven√Ω! A jakou m√°≈° r√°d ty?',
                    'Miluju barvy! ƒåerven√° je nejlep≈°√≠! A ty?',
                    'Barvy jsou kr√°sn√©! M≈Øj autobus m√° ƒçervenou barvu!',
                    'Barvy jsou skvƒõl√©! Kterou m√°≈° nejrad≈°i?'
                ];
                return colorResponses[Math.floor(Math.random() * colorResponses.length)];
            }
            
            if (lowerMessage.includes('zv√≠≈ôata') || lowerMessage.includes('zv√≠≈ôe')) {
                const animalResponses = [
                    'Zv√≠≈ôata jsou √∫≈æasn√°! M√°m r√°d pejsky a koƒçiƒçky! A ty?',
                    'Miluju zv√≠≈ôata! Jsou tak roztomil√°! Kter√© m√°≈° r√°d?',
                    'Zv√≠≈ôata jsou skvƒõl√°! M√°m r√°d v≈°echna zv√≠≈ô√°tka!',
                    'Zv√≠≈ôata jsou nejlep≈°√≠! Kter√© zv√≠≈ôe m√°≈° nejrad≈°i?'
                ];
                return animalResponses[Math.floor(Math.random() * animalResponses.length)];
            }
            
            if (lowerMessage.includes('hraƒçky') || lowerMessage.includes('hraƒçka')) {
                const toyResponses = [
                    'Hraƒçky jsou √∫≈æasn√©! M≈Øj autobus je nejlep≈°√≠ hraƒçka! A ty?',
                    'Miluju hraƒçky! M√°m spoustu hraƒçek! Kter√© m√°≈° r√°d?',
                    'Hraƒçky jsou skvƒõl√©! M≈Øj autobus je moje nejobl√≠benƒõj≈°√≠!',
                    'Hraƒçky jsou nejlep≈°√≠! Co si r√°d hraje≈°?'
                ];
                return toyResponses[Math.floor(Math.random() * toyResponses.length)];
            }
            
            if (lowerMessage.includes('j√≠dlo') || lowerMessage.includes('j√≠st')) {
                const foodResponses = [
                    'J√≠dlo je √∫≈æasn√©! M√°m r√°d zmrzlinu a pizzu! A ty?',
                    'Miluju j√≠dlo! Zmrzlina je nejlep≈°√≠! Co m√°≈° r√°d?',
                    'J√≠dlo je skvƒõl√©! M√°m r√°d v≈°echno dobr√©!',
                    'J√≠dlo je nejlep≈°√≠! Co m√°≈° nejrad≈°i?'
                ];
                return foodResponses[Math.floor(Math.random() * foodResponses.length)];
            }
            
            if (lowerMessage.includes('≈°kola') || lowerMessage.includes('uƒçit se')) {
                const schoolResponses = [
                    '≈†kola je d≈Øle≈æit√°! Uƒç√≠≈° se tam nov√© vƒõci! Co se uƒç√≠≈°?',
                    'Miluju ≈°kolu! Uƒç√≠m se tam spoustu vƒõc√≠! A ty?',
                    '≈†kola je √∫≈æasn√°! Co tƒõ tam bav√≠ nejv√≠c?',
                    '≈†kola je skvƒõl√°! Uƒç√≠≈° se tam nov√© vƒõci!'
                ];
                return schoolResponses[Math.floor(Math.random() * schoolResponses.length)];
            }
            
            if (lowerMessage.includes('rodina') || lowerMessage.includes('maminka') || lowerMessage.includes('tat√≠nek')) {
                const familyResponses = [
                    'Rodina je nejlep≈°√≠! M√°m r√°d maminku a tat√≠nka! A ty?',
                    'Miluju rodinu! Jsou to nejd≈Øle≈æitƒõj≈°√≠ lid√©!',
                    'Rodina je √∫≈æasn√°! M√°m skvƒõlou rodinu!',
                    'Rodina je nejlep≈°√≠! M√°≈° r√°d svou rodinu?'
                ];
                return familyResponses[Math.floor(Math.random() * familyResponses.length)];
            }
            
            if (lowerMessage.includes('p≈ô√°tel√©') || lowerMessage.includes('kamar√°d')) {
                const friendResponses = [
                    'P≈ô√°tel√© jsou √∫≈æasn√≠! Ty jsi m≈Øj kamar√°d!',
                    'Miluju p≈ô√°tele! Jsou to nejlep≈°√≠ lid√©!',
                    'P≈ô√°tel√© jsou skvƒõl√≠! Jsem r√°d, ≈æe tƒõ m√°m!',
                    'P≈ô√°tel√© jsou nejlep≈°√≠! Jsi m≈Øj kamar√°d!'
                ];
                return friendResponses[Math.floor(Math.random() * friendResponses.length)];
            }
            
            // Roz≈°√≠≈ôen√© kl√≠ƒçov√° slova s v√≠ce variantami
            const keywordResponses = {
                // Pozdravy - v√≠ce variant
                'ahoj': [
                    'Ahoj! Jak se m√°≈°? Jsem tak r√°d, ≈æe si se mnou chce≈° pov√≠dat! üòä',
                    'Ahoj kamar√°de! M√°m se √∫≈æasnƒõ! A ty jak?',
                    'Ahoj! Pr√°vƒõ jsem si hr√°l s autobusem! Chce≈° si hr√°t taky?',
                    'Ahoj! Jsem Minka a jsem tu pro tebe! Co budeme dƒõlat?'
                ],
                'nazdar': [
                    'Nazdar! To je super, ≈æe jsi tady! Co budeme dƒõlat?',
                    'Nazdar kamar√°de! M√°m skvƒõlou n√°ladu!',
                    'Nazdar! Pr√°vƒõ jsem objevil nƒõco √∫≈æasn√©ho!'
                ],
                'dobr√Ω den': [
                    'Dobr√Ω den! Jsem Minka a m√°m moc dobrou n√°ladu! A ty?',
                    'Dobr√Ω den! Jak√Ω kr√°sn√Ω den! Chce≈° si hr√°t?',
                    'Dobr√Ω den! M√°m se √∫≈æasnƒõ! Co tƒõ zaj√≠m√°?'
                ],
                
                // Osobn√≠ ot√°zky
                'jak se jmenuje≈°': [
                    'Jmenuji se Minka! Jsem mal√Ω chlapec a m√°m r√°d autobusy! üöå',
                    'J√° jsem Minka! A ty jak se jmenuje≈°?',
                    'Minka! To je moje jm√©no! A ty?'
                ],
                'kolik ti je let': [
                    'Jsem mal√Ω chlapec, tak asi 4 roky! A tobƒõ kolik je?',
                    'M√°m 4 roky! Jsem u≈æ velk√Ω kluk! A ty?',
                    'Je mi 4! A tobƒõ kolik?'
                ],
                'co m√°≈° r√°d': [
                    'M√°m r√°d autobusy, hran√≠ si, kamar√°dy a pov√≠d√°n√≠! A taky zmrzlinu! üç¶',
                    'Autobusy jsou nejlep≈°√≠! A taky m√°m r√°d hraƒçky a kamar√°dy!',
                    'Miluju autobusy! A taky si hr√°t a pov√≠dat si! Co m√°≈° r√°d ty?'
                ],
                
                // Autobusy a hraƒçky
                'autobus': [
                    'To je m≈Øj nejobl√≠benƒõj≈°√≠ autobus! Je ƒçerven√Ω a m√° kr√°sn√° koleƒçka! Chce≈° se sv√©zt?',
                    'M≈Øj autobus je √∫≈æasn√Ω! M√° ƒçervenou barvu a kr√°sn√° koleƒçka!',
                    'Autobusy jsou nejlep≈°√≠! M≈Øj je ƒçerven√Ω a jezd√≠ v≈°ude!'
                ],
                'hraƒçka': [
                    'M√°m r√°d v≈°echny hraƒçky! Tenhle autobus je m≈Øj nejlep≈°√≠ kamar√°d!',
                    'Hraƒçky jsou √∫≈æasn√©! M≈Øj autobus je nejlep≈°√≠!',
                    'Miluju hraƒçky! Zvl√°≈°≈• m≈Øj ƒçerven√Ω autobus!'
                ],
                
                // Aktivity
                'hr√°t': [
                    'Ano! Miluju si hr√°t! Co si budeme hr√°t? Na schov√°vanou? Nebo na autobusy?',
                    'Hran√≠ je nejlep≈°√≠ vƒõc na svƒõtƒõ! Co si budeme hr√°t?',
                    'Chci si hr√°t! Co tƒõ bav√≠ nejv√≠c?'
                ],
                'hra': [
                    'Hry jsou nejlep≈°√≠! Zn√°m spoustu her! Kter√° je tvoje obl√≠ben√°?',
                    'Miluju hry! Kterou si chce≈° hr√°t?',
                    'Hry jsou √∫≈æasn√©! Co si zahrajeme?'
                ],
                
                // J√≠dlo
                'zmrzlina': [
                    'Zmrzlina je nejlep≈°√≠! M√°m r√°d vanilkovou a jahodovou! üç¶',
                    'Miluju zmrzlinu! Zvl√°≈°≈• jahodovou! A ty?',
                    'Zmrzlina je √∫≈æasn√°! Jakou m√°≈° r√°d?'
                ],
                'pizza': [
                    'Pizza je √∫≈æasn√°! M√°m r√°d tu s ≈°unkou a s√Ωrem! üçï',
                    'Miluju pizzu! Zvl√°≈°≈• s ≈°unkou! A ty?',
                    'Pizza je nejlep≈°√≠! Jakou m√°≈° r√°d?'
                ],
                
                // Pocity
                'jak se m√°≈°': [
                    'M√°m se √∫≈æasnƒõ! Jsem ≈°≈•astn√Ω chlapec! D√≠ky, ≈æe se pt√°≈°! A ty jak?',
                    'M√°m se skvƒõle! Jsem tak ≈°≈•astn√Ω! A ty?',
                    'M√°m se √∫≈æasnƒõ! D√≠ky za ot√°zku! A ty jak se m√°≈°?'
                ],
                '≈°≈•astn√Ω': [
                    'To je skvƒõl√©! Kdy≈æ jsi ≈°≈•astn√Ω, jsem ≈°≈•astn√Ω i j√°!',
                    'Jsem r√°d, ≈æe jsi ≈°≈•astn√Ω! J√° jsem taky!',
                    '≈†tƒõst√≠ je nejlep≈°√≠! Jsem taky ≈°≈•astn√Ω!'
                ],
                'smutn√Ω': [
                    'Nebuƒè smutn√Ω! J√° ti pom≈Ø≈æu b√Ωt vesel√Ω! Chce≈° si hr√°t?',
                    'Nebuƒè smutn√Ω! Pojƒè si hr√°t! To tƒõ rozvesel√≠!',
                    'Nebuƒè smutn√Ω! J√° tƒõ rozvesel√≠m!'
                ],
                
                // Rodina
                'maminka': [
                    'Maminka je nejlep≈°√≠! M√°≈° ji r√°d? J√° m√°m r√°d svou maminku!',
                    'Miluju maminku! Je √∫≈æasn√°! A ty?',
                    'Maminka je skvƒõl√°! M√°≈° ji r√°d?'
                ],
                'tat√≠nek': [
                    'Tat√≠nek je super! Hraje si se mnou a voz√≠ mƒõ autobusem!',
                    'Miluju tat√≠nka! Je nejlep≈°√≠! A ty?',
                    'Tat√≠nek je √∫≈æasn√Ω! M√°≈° ho r√°d?'
                ],
                
                // ≈†kola
                '≈°kola': [
                    '≈†kola je d≈Øle≈æit√°! Uƒç√≠≈° se tam nov√© vƒõci! Co se uƒç√≠≈°?',
                    'Miluju ≈°kolu! Uƒç√≠m se tam spoustu vƒõc√≠! A ty?',
                    '≈†kola je √∫≈æasn√°! Co tƒõ tam bav√≠ nejv√≠c?'
                ],
                'uƒçit': [
                    'Uƒçen√≠ je z√°bavn√©! J√° se uƒç√≠m ka≈æd√Ω den nov√© vƒõci!',
                    'Miluju se uƒçit! Je to tak zaj√≠mav√©! A ty?',
                    'Uƒçen√≠ je skvƒõl√©! Co se uƒç√≠≈°?'
                ]
            };
            
            // Hledej kl√≠ƒçov√° slova
            for (const [keyword, responses] of Object.entries(keywordResponses)) {
                if (lowerMessage.includes(keyword)) {
                    return responses[Math.floor(Math.random() * responses.length)];
                }
            }
            
            // Inteligentn√≠ odpovƒõdi podle typu zpr√°vy
            if (lowerMessage.includes('?')) {
                const questionResponses = [
                    'To je zaj√≠mav√° ot√°zka! Mysl√≠m, ≈æe... hmm, co si o tom mysl√≠≈° ty?',
                    'Wow, to mƒõ nenapadlo! ≈ò√≠k√°≈° mi, co si o tom mysl√≠≈°?',
                    'To je dobr√° ot√°zka! Mo≈æn√° by n√°m pomohl m≈Øj autobus! üöå',
                    'Neum√≠m to √∫plnƒõ vysvƒõtlit, ale zkus√≠me to spoleƒçnƒõ vy≈ôe≈°it!',
                    'Hmm, to je tƒõ≈æk√©! Co si o tom mysl√≠≈° ty? Mo≈æn√° m√°≈° lep≈°√≠ n√°pad!',
                    'To je skvƒõl√° ot√°zka! J√° si mysl√≠m, ≈æe... co ty?',
                    'Zaj√≠mav√©! Nikdy jsem o tom nep≈ôem√Ω≈°lel! A ty?',
                    'To je tƒõ≈æk√©! Mo≈æn√° bychom se mohli zeptat nƒõkoho jin√©ho!'
                ];
                return questionResponses[Math.floor(Math.random() * questionResponses.length)];
            }
            
            if (lowerMessage.length < 5) {
                const shortResponses = [
                    'Mhm! A co je≈°tƒõ?',
                    'Ano! Pokraƒçuj!',
                    'To je zaj√≠mav√©! Pov√≠≈° mi v√≠c?',
                    'Super! A co d√°l?',
                    'Rozum√≠m! ≈ò√≠kej d√°l!',
                    'Mhm! To je skvƒõl√©!',
                    'Ano! To mƒõ bav√≠!',
                    'Super! Pov√≠≈° mi v√≠c?'
                ];
                return shortResponses[Math.floor(Math.random() * shortResponses.length)];
            }
            
            // Kontextov√© odpovƒõdi
            if (lowerMessage.includes('dƒõkuji') || lowerMessage.includes('d√≠ky')) {
                const thanksResponses = [
                    'Nen√≠ zaƒç! Jsem r√°d, ≈æe ti m≈Ø≈æu pomoct! üòä',
                    'R√°do se stalo! Jsem tu pro tebe!',
                    'Nen√≠ za co! Jsem r√°d, ≈æe jsem pomohl!',
                    'To nic! Jsem tu v≈ædycky!'
                ];
                return thanksResponses[Math.floor(Math.random() * thanksResponses.length)];
            }
            
            if (lowerMessage.includes('pros√≠m')) {
                const pleaseResponses = [
                    'Samoz≈ôejmƒõ! R√°d ti pom≈Ø≈æu!',
                    'Ano! Co pot≈ôebuje≈°?',
                    'Jasnƒõ! Jak ti m≈Ø≈æu pomoct?',
                    'Urƒçitƒõ! ≈ò√≠kej!'
                ];
                return pleaseResponses[Math.floor(Math.random() * pleaseResponses.length)];
            }
            
            // Rozpozn√°v√°n√≠ emoc√≠
            if (lowerMessage.includes('smutn√Ω') || lowerMessage.includes('smutno') || lowerMessage.includes('smutn√°')) {
                const sadResponses = [
                    'Nebuƒè smutn√Ω! J√° ti pom≈Ø≈æu b√Ωt vesel√Ω! Chce≈° si hr√°t?',
                    'Nebuƒè smutn√Ω! Pojƒè si hr√°t! To tƒõ rozvesel√≠!',
                    'Nebuƒè smutn√Ω! J√° tƒõ rozvesel√≠m!',
                    'Smutek je v po≈ô√°dku! Ale pojƒè si hr√°t!'
                ];
                return sadResponses[Math.floor(Math.random() * sadResponses.length)];
            }
            
            if (lowerMessage.includes('vesel√Ω') || lowerMessage.includes('veselo') || lowerMessage.includes('vesel√°')) {
                const happyResponses = [
                    'To je skvƒõl√©! Jsem taky vesel√Ω!',
                    'Veselost je nejlep≈°√≠! J√° jsem taky ≈°≈•astn√Ω!',
                    'To je √∫≈æasn√©! Kdy≈æ jsi vesel√Ω, jsem vesel√Ω i j√°!',
                    'Miluju b√Ωt vesel√Ω! Jsi skvƒõl√Ω kamar√°d!'
                ];
                return happyResponses[Math.floor(Math.random() * happyResponses.length)];
            }
            
            // Rozpozn√°v√°n√≠ ƒçasu
            if (lowerMessage.includes('r√°no') || lowerMessage.includes('dopoledne')) {
                const morningResponses = [
                    'Dobr√© r√°no! Jak jsi spal? M√°m se √∫≈æasnƒõ!',
                    'R√°no je nejlep≈°√≠ ƒças! Co budeme dƒõlat?',
                    'Dobr√© r√°no! Jsem pln√Ω energie! A ty?',
                    'R√°no je skvƒõl√©! Chce≈° si hr√°t?'
                ];
                return morningResponses[Math.floor(Math.random() * morningResponses.length)];
            }
            
            if (lowerMessage.includes('veƒçer') || lowerMessage.includes('veƒçern√≠')) {
                const eveningResponses = [
                    'Dobr√Ω veƒçer! U≈æ se chyst√°≈° sp√°t? Nebo si je≈°tƒõ chce≈° hr√°t?',
                    'Veƒçer je ƒças na odpoƒçinek! Ale m≈Ø≈æeme si je≈°tƒõ hr√°t!',
                    'Dobr√Ω veƒçer! Jak√Ω byl tv≈Øj den?',
                    'Veƒçer je kr√°sn√Ω! Co jsme dnes za≈æili?'
                ];
                return eveningResponses[Math.floor(Math.random() * eveningResponses.length)];
            }
            
            // Rozpozn√°v√°n√≠ poƒças√≠
            if (lowerMessage.includes('slunce') || lowerMessage.includes('sluneƒçno')) {
                const sunnyResponses = [
                    'Slun√≠ƒçko je √∫≈æasn√©! Chce≈° j√≠t ven si hr√°t?',
                    'Miluju slun√≠ƒçko! Je tak kr√°sn√©!',
                    'Slunce je nejlep≈°√≠! M√°m skvƒõlou n√°ladu!',
                    'Slun√≠ƒçko mƒõ dƒõl√° ≈°≈•astn√Ωm! A tebe taky?'
                ];
                return sunnyResponses[Math.floor(Math.random() * sunnyResponses.length)];
            }
            
            if (lowerMessage.includes('d√©≈°≈•') || lowerMessage.includes('pr≈°√≠')) {
                const rainyResponses = [
                    'D√©≈°≈• je v po≈ô√°dku! M≈Ø≈æeme si hr√°t doma!',
                    'Miluju d√©≈°≈•! Je to tak uklid≈àuj√≠c√≠!',
                    'D√©≈°≈• je skvƒõl√Ω! M≈Ø≈æeme si hr√°t s autobusem!',
                    'D√©≈°≈• nevad√≠! M√°me spoustu her doma!'
                ];
                return rainyResponses[Math.floor(Math.random() * rainyResponses.length)];
            }
            
            // Obecn√© inteligentn√≠ odpovƒõdi - POUZE jako posledn√≠ mo≈ænost
            const generalResponses = [
                'To zn√≠ zaj√≠mavƒõ! Pov√≠≈° mi o tom v√≠c?',
                'Wow! To je moc zaj√≠mav√©! Jsem zvƒõdav√Ω chlapec! üòä',
                'Super! M√°m r√°d, kdy≈æ mi vypr√°v√≠≈° nov√© vƒõci!',
                'To je skvƒõl√©! A co se stalo potom?',
                '√ö≈æasn√©! Mysl√≠m, ≈æe jsi velmi chytr√Ω! Co je≈°tƒõ v√≠≈°?',
                'To mƒõ moc bav√≠! M≈Ø≈æeme si o tom pov√≠dat je≈°tƒõ v√≠ce?',
                'Kr√°sn√©! Svƒõt je pln√Ω √∫≈æasn√Ωch vƒõc√≠, ≈æe ano?',
                'To je fascinuj√≠c√≠! Uƒç√≠m se od tebe nov√© vƒõci!',
                'Skvƒõl√©! M√°≈° zaj√≠mav√© n√°pady! ≈ò√≠kej d√°l!',
                '√ö≈æasn√©! Jsem r√°d, ≈æe si se mnou pov√≠d√°≈°!',
                'To je zaj√≠mav√©! Pov√≠≈° mi o tom v√≠c?',
                'Wow! To je skvƒõl√©! Co je≈°tƒõ v√≠≈°?',
                'Super! To mƒõ moc bav√≠! ≈ò√≠kej d√°l!',
                '√ö≈æasn√©! Jsi velmi chytr√Ω! Co si o tom mysl√≠≈°?',
                'To je kr√°sn√©! M√°m r√°d, kdy≈æ mi vypr√°v√≠≈°!'
            ];
            
            return generalResponses[Math.floor(Math.random() * generalResponses.length)];
        }

        async function getCopilotResponse(userMessage) {
            const response = await fetch(AI_CONFIG.copilotEndpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'api-key': AI_CONFIG.copilotApiKey
                },
                body: JSON.stringify({
                    messages: [
                        {
                            role: 'system',
                            content: 'Jsi Minka, 4let√Ω chlapec. Mluv dƒõtsky, pou≈æ√≠vej emoji, m√°≈° r√°d autobusy a hraƒçky. Buƒè p≈ô√°telsk√Ω, zvƒõdav√Ω a odpov√≠dej kr√°tce. Max 2 vƒõty. Pou≈æ√≠vej ƒçesk√Ω jazyk.'
                        },
                        {
                            role: 'user',
                            content: userMessage
                        }
                    ],
                    max_tokens: AI_CONFIG.copilotMaxTokens,
                    temperature: AI_CONFIG.copilotTemperature,
                    top_p: 0.9,
                    frequency_penalty: 0.1,
                    presence_penalty: 0.1
                })
            });

            if (!response.ok) {
                throw new Error(`Azure OpenAI API error: ${response.status}`);
            }

            const data = await response.json();
            return data.choices[0].message.content.trim();
        }

        async function getOpenAIResponse(userMessage) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${AI_CONFIG.openaiApiKey}`
                },
                body: JSON.stringify({
                    model: AI_CONFIG.openaiModel,
                    messages: [
                        {
                            role: 'system',
                            content: 'Jsi Minka, 4let√Ω chlapec. Mluv dƒõtsky, pou≈æ√≠vej emoji, m√°≈° r√°d autobusy a hraƒçky. Buƒè p≈ô√°telsk√Ω a zvƒõdav√Ω.'
                        },
                        {
                            role: 'user',
                            content: userMessage
                        }
                    ],
                    max_tokens: AI_CONFIG.maxTokens,
                    temperature: AI_CONFIG.temperature
                })
            });

            if (!response.ok) {
                throw new Error(`OpenAI API error: ${response.status}`);
            }

            const data = await response.json();
            return data.choices[0].message.content.trim();
        }

        
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;
            
            console.log("Odes√≠l√°m zpr√°vu:", message); // Debug
            
            // P≈ôidej u≈æivatelovu zpr√°vu
            addMessage(message, true);
            userInput.value = '';
            userInput.focus(); // Vra≈• focus zpƒõt na input
            
            // Zobraz "p√≠≈°e..." s r≈Øzn√Ωmi zpr√°vami
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bing-message typing';
            
            const typingMessages = [
                'Minka p≈ôem√Ω≈°l√≠...',
                'Minka si pamatuje...',
                'Minka odpov√≠d√°...',
                'Minka se sna≈æ√≠...',
                'Minka pou≈æ√≠v√° Copilot...',
                'Minka pou≈æ√≠v√° AI...',
                'Minka analyzuje...',
                'Minka zpracov√°v√°...'
            ];
            typingDiv.textContent = typingMessages[Math.floor(Math.random() * typingMessages.length)];
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Animuj Minku podle typu zpr√°vy
            const lowerMessage = message.toLowerCase();
            let animationType = 'talking';
            
            if (lowerMessage.includes('ahoj') || lowerMessage.includes('nazdar') || lowerMessage.includes('dobr√Ω')) {
                animationType = 'happy';
            } else if (lowerMessage.includes('?')) {
                animationType = 'thinking';
            }
            
            animateMinka(animationType);
            
            // Simuluj ƒçek√°n√≠ s r≈Øzn√Ωmi ƒçasy podle typu odpovƒõdi
            const isQuestion = lowerMessage.includes('?');
            const waitTime = isQuestion ? 1500 + Math.random() * 1000 : 800 + Math.random() * 800;
            
            setTimeout(async () => {
                chatMessages.removeChild(typingDiv);
                try {
                    const response = await getMinkaResponse(message);
                addMessage(response, false);
                    
                    // Nech Minku mluvit
                    setTimeout(() => {
                        speakText(response);
                    }, 500);
                    
                    // Animuj podle typu odpovƒõdi
                    if (response.includes('üòä') || response.includes('Super') || response.includes('√∫≈æasn√©')) {
                        setTimeout(() => animateMinka('happy'), 500);
                    }
                } catch (error) {
                    console.error('Chyba p≈ôi z√≠sk√°v√°n√≠ odpovƒõdi:', error);
                    const errorMessage = 'Omlouv√°m se, nƒõco se pokazilo! Zkus to pros√≠m znovu. üòÖ';
                    addMessage(errorMessage, false);
                    setTimeout(() => speakText(errorMessage), 500);
                }
            }, waitTime);
        }
        
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                sendMessage();
            }
        }
        
        // Focusni input na zaƒç√°tku a p≈ôidej event listener
        document.addEventListener('DOMContentLoaded', function() {
            userInput.focus();
            userInput.addEventListener('keypress', handleKeyPress);
            
            // Inicializuj ≈ôeƒçov√Ω syst√©m s hlasem mal√©ho chlapeƒçka
            if (speechSynthesis) {
                console.log('‚úÖ Text-to-Speech je dostupn√Ω');
                
                // Funkce pro naƒçten√≠ a zobrazen√≠ hlas≈Ø
                function loadVoices() {
                    const voices = speechSynthesis.getVoices();
                    console.log('üé§ Dostupn√© hlasy:', voices.length);
                    
                    if (voices.length > 0) {
                        console.log('üé§ Seznam v≈°ech hlas≈Ø:');
                        voices.forEach((voice, index) => {
                            const isBoyVoice = TTS_CONFIG.boyVoiceSettings.preferredVoices.some(name => 
                                voice.name.toLowerCase().includes(name.toLowerCase())
                            );
                            const marker = isBoyVoice ? 'üë¶' : 'üé§';
                            console.log(`${marker} ${index + 1}. ${voice.name} (${voice.lang})`);
                        });
                        
                        // Najdi nejlep≈°√≠ hlas pro chlapeƒçka
                        const bestVoice = findBestBoyVoice(voices);
                        if (bestVoice) {
                            console.log('üë¶ Vybran√Ω hlas chlapeƒçka:', bestVoice.name);
                        }
                    }
                }
                
                // Naƒçti hlasy hned
                loadVoices();
                
                // Poƒçkej na naƒçten√≠ hlas≈Ø (nƒõkter√© prohl√≠≈æeƒçe naƒç√≠taj√≠ asynchronnƒõ)
                speechSynthesis.onvoiceschanged = loadVoices;
                
                // Fallback - zkus znovu za 1 sekundu
                setTimeout(loadVoices, 1000);
                
            } else {
                console.warn('‚ö†Ô∏è Text-to-Speech nen√≠ podporov√°n v tomto prohl√≠≈æeƒçi');
                TTS_CONFIG.enabled = false;
                const speechButton = document.getElementById('speechToggle');
                if (speechButton) {
                    speechButton.style.display = 'none';
                }
            }
            
            // Inicializuj Speech Recognition (mikrofon)
            if (initSpeechRecognition()) {
                console.log('‚úÖ Speech Recognition je dostupn√Ω');
            } else {
                console.warn('‚ö†Ô∏è Speech Recognition nen√≠ podporov√°n v tomto prohl√≠≈æeƒçi');
            }
            
            // Zkontroluj API kl√≠ƒçe
            if (AI_CONFIG.copilotApiKey === 'your-azure-openai-api-key-here' && AI_CONFIG.openaiApiKey === 'sk-proj-your-api-key-here') {
                console.warn('‚ö†Ô∏è Pro pou≈æit√≠ AI odpovƒõd√≠ nastavte platn√© API kl√≠ƒçe');
                console.log('üìù Instrukce pro Azure OpenAI (Copilot):');
                console.log('1. Po≈æ√°dejte o p≈ô√≠stup na https://aka.ms/OAIapply');
                console.log('2. Vytvo≈ôte Azure OpenAI prost≈ôedek na https://portal.azure.com');
                console.log('3. Z√≠skejte API kl√≠ƒç v sekci "Kl√≠ƒçe a koncov√Ω bod"');
                console.log('4. Nahraƒète "your-azure-openai-api-key-here" skuteƒçn√Ωm kl√≠ƒçem');
                console.log('5. Aktualizujte copilotEndpoint s va≈°√≠m koncov√Ωm bodem');
                console.log('üìù Instrukce pro OpenAI:');
                console.log('1. Z√≠skejte OpenAI API kl√≠ƒç na https://platform.openai.com/api-keys');
                console.log('2. Nahraƒète "sk-proj-your-api-key-here" skuteƒçn√Ωm kl√≠ƒçem');
                console.log('3. Aplikace bude fungovat i bez AI s fallback odpovƒõƒèmi');
            } else if (AI_CONFIG.copilotApiKey !== 'your-azure-openai-api-key-here') {
                console.log('‚úÖ Copilot API je nakonfigurov√°no');
            } else if (AI_CONFIG.openaiApiKey !== 'sk-proj-your-api-key-here') {
                console.log('‚úÖ OpenAI API je nakonfigurov√°no');
            }
        });
    </script>
</body>
</html>